version: "3.1"

rules:

# CONVERSATION START 
- rule: Greet on conversation start
  conversation_start: true
  steps:
    - action: utter_greet

- rule: Respond to greeting
  steps:
    - intent: greet
    - action: utter_greet

- rule: Say goodbye
  steps:
    - intent: goodbye
    - action: utter_goodbye

- rule: Say thanks
  steps:
    - intent: thanks
    - action: utter_you_are_welcome

# SAFETY-NET INTENTS
- rule: Handle chitchat
  steps:
    - intent: chitchat
    - action: utter_chitchat

- rule: Handle bot challenge
  steps:
    - intent: bot_challenge
    - action: utter_bot_challenge

- rule: Handle affirm
  steps:
    - intent: affirm
    - action: utter_affirm

- rule: Handle deny
  steps:
    - intent: deny
    - action: utter_deny

- rule: Handle out of scope
  steps:
    - intent: out_of_scope
    - action: utter_out_of_scope

# ADMIN INTENTS
- rule: Add classroom
  steps:
    - intent: add_classroom
    - action: utter_add_classroom

- rule: Assign class teacher
  steps:
    - intent: assign_class_teacher
    - action: utter_assign_class_teacher

- rule: Delete classroom
  steps:
    - intent: delete_classroom
    - action: utter_delete_classroom

- rule: Update school settings
  steps:
    - intent: update_school_settings
    - action: utter_update_school_settings

- rule: Transfer student
  steps:
    - intent: transfer_student
    - action: utter_transfer_student

- rule: Input headteacher comments
  steps:
    - intent: input_headteacher_comments
    - action: utter_input_headteacher_comments

- rule: Add user role
  steps:
    - intent: add_user_role
    - action: utter_add_user_role

- rule: Add new user
  steps:
    - intent: add_new_user
    - action: utter_add_new_user

- rule: Remove user role
  steps:
    - intent: remove_user_role
    - action: utter_remove_user_role

- rule: Check schemes
  steps:
    - intent: check_schemes
    - action: utter_check_schemes

- rule: Evaluate lesson plan
  steps:
    - intent: evaluate_lesson_plan
    - action: utter_evaluate_lesson_plan

# CLASS TEACHER INTENTS
- rule: Mark attendance
  steps:
    - intent: mark_attendance
    - action: utter_mark_attendance

- rule: Add student to register
  steps:
    - intent: add_student_to_register
    - action: utter_add_student_to_register

- rule: Remove student
  steps:
    - intent: remove_student
    - action: utter_remove_student

- rule: Generate reports
  steps:
    - intent: generate_reports
    - action: utter_generate_reports

- rule: Link student to guardian
  steps:
    - intent: link_student_guardian
    - action: utter_link_student_guardian

- rule: Check attendance
  steps:
    - intent: check_attendance
    - action: utter_check_attendance

# SUBJECT TEACHER INTENTS
- rule: Create lesson plan
  steps:
    - intent: create_lesson_plan
    - action: utter_create_lesson_plan

- rule: Upload scores
  steps:
    - intent: upload_scores
    - action: utter_upload_scores

- rule: Share scheme
  steps:
    - intent: share_scheme
    - action: utter_share_scheme

- rule: Receive shared plan
  steps:
    - intent: receive_shared_plan
    - action: utter_receive_shared_plan

- rule: Perform formative assessment
  steps:
    - intent: formative_assessment
    - action: utter_formative_assessment

# KURASA HELP (Grok-backed)
- rule: Handle general Kurasa questions with Grok
  steps:
    - intent: ask_kurasa
    - action: action_ask_grok

# FALLBACKS
# Tier 1: explicit out_of_scope handled above by utter_out_of_scope

# Tier 2: low-confidence NLU fallback goes to Grok for smart answer
- rule: Fallback to Grok when intent is not clear
  steps:
    - intent: nlu_fallback
    - action: action_ask_grok

# using RulePolicy's action_default_fallback, map it to Grok too.
- rule: Core default fallback to Grok
  steps:
    - action: action_default_fallback
    - action: action_ask_grok
